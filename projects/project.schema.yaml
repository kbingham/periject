---

## See https://pykwalify.readthedocs.io/en/unstable/validation-rules.html

schema;gitcommit:
  desc: SHA1 in the form \b[0-9a-f]{12,40}\b.*
  type: str
  pattern: \b[0-9a-f]{12,40}\b.*

schema;uuid:
  desc: Unique key defining items and relationship links.
        Generated by the application 'uuid'
  type: str
  pattern: \b[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}\b


###
### Our main schema
###

type: map
mapping:
  title:
    type: str
    required: True

  team:
    type: str
    required: True
    enum: ['Core', 'IO', 'MM']

  key:
    include: uuid
    required: True

  status:
    type: str
    required: True
    enum: ['New', 'Active', 'Blocked', 'Paused', 'Done', 'Abandoned']

# Optional Fields
  assignee:
    type: str
    enum: ['BSP', 'Geert', 'Jacopo', 'Kieran', 'Laurent', 'Magnus', 'Marek',
           'Morimoto', 'Niklas', 'Shimoda', 'Ulrich', 'Wolfram']

  bsp-commits:
    desc: A sequence / list of related BSP commits
          https://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git/commit/?id=
    sequence:
    - include: gitcommit

  upstream:
    desc: References to upstream commits
    sequence:
    - mapping:
        torvalds:
          desc: https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=
          include: gitcommit
        next:
          desc: https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=
          include: gitcommit
        pw.linuxtv:
          desc: https://patchwork.linuxtv.org/patch/
          type: int
        url:
          desc: Free form URL reference # URL validation is *hard*
          type: str

  relationships:
    desc: Relationships to other data items.
    sequence:
    - mapping:
        parent:
          desc: A reference to another topic key which must already exist
          include: uuid
        depends:
          desc: Items which must be closed before this item can be closed successfully
          include: uuid
        duplicates:
          desc: A link to another task which refers to the same work item as this
          include: uuid
        blocks:
          desc: Tasks prevented from progressing until this task is complete
          include: uuid

  target-date:
    type: date

  comments:
    sequence:
    - type: str
